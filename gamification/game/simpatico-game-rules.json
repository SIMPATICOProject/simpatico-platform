{ "_id" : { "$oid" : "5a5c9e973d30274522896608" }, "_class" : "eu.trentorise.game.model.core.DBRule", "content" : "package eu.trentorise.game.model\n\n\nimport java.time.*;\nimport eu.trentorise.game.core.Utility;\n\nglobal Utility utils;\n\nglobal Double login_action_score;\nglobal Double registration_action_score;\nglobal Double make_question_action_score;\nglobal Double answer_question_action_score;\nglobal Double like_action_score;\nglobal Double update_description_action_score;\n\nglobal Double login_bonus_1;\nglobal Double login_bonus_2;\nglobal Integer login_count_bonus_1;\nglobal Integer login_count_bonus_2;\n\n\n\nrule \"login action\"\nlock-on-active\nwhen\n\t$action: Action(id == \"login\")\n    $pc : PointConcept(name == \"karma points\")\n    $cd : CustomData()\nthen\n\t$pc.setScore($pc.getScore() + login_action_score);\n\tupdate($pc);\n\t\n\t// check for login in rows\n\tInteger loginCount = $cd.get(\"loginCount\") == null ? 1 : (Integer) $cd.get(\"loginCount\");\n\tLocalDate lastLoginDate = $cd.get(\"lastLogin\") == null ? LocalDate.now() : LocalDate.parse((String) $cd.get(\"lastLogin\"));\n\tString lastLogin = lastLoginDate.toString();\n\t  \n\tLocalDate today = LocalDate.now();\n  \n\tDuration duration = Duration.between(today.atStartOfDay(), lastLoginDate.atStartOfDay());\n\n    long diff = duration.abs().toDays();\n    \n    if(diff == 1) {\n    \tloginCount++;\n    } else if(diff > 1) {\n    \tloginCount = 1;\n    }\n\n   \tlastLogin = today.toString();\n    $cd.put(\"loginCount\",loginCount);\n    $cd.put(\"lastLogin\",lastLogin);\n\tupdate($cd);\nend\n\n\n\nrule \"login in a row low bonus\"\nwhen\n\tAction(id == \"login\")\n\t$cd: CustomData(this[\"loginCount\"] == login_count_bonus_1)\n\t$pc: PointConcept(name == \"karma points\")\nthen\t\n\tutils.log(\"login LOW BONUS\");\n\t$pc.setScore($pc.getScore() + login_bonus_1);\n\tupdate($pc);\nend\n\n\nrule \"login in a row high bonus\"\nwhen\n\tAction(id == \"login\")\n\t$cd: CustomData(this[\"loginCount\"] == login_count_bonus_2)\n\t$pc: PointConcept(name == \"karma points\")\nthen\t\n\tutils.log(\"login HIGH BONUS\");\n\t$pc.setScore($pc.getScore() + login_bonus_2);\n\tupdate($pc);\n\t\n\t$cd.put(\"loginCount\",1);\n    $cd.put(\"lastLogin\",LocalDate.now().toString());\n\tupdate($cd);\nend \n\n\nrule \"registration action\"\nwhen\n\t$action: Action(id == \"registration\")\n    $pc : PointConcept(name == \"karma points\")\nthen\n\t$pc.setScore($pc.getScore() + registration_action_score);\n\tupdate($pc);\nend\n\nrule \"make question action\"\nwhen\n\t$action: Action(id == \"make-question\")\n    $pc : PointConcept(name == \"karma points\")\nthen\n\t$pc.setScore($pc.getScore() + make_question_action_score);\n\tupdate($pc);\nend\n\nrule \"answer question action\"\nwhen\n\t$action: Action(id == \"answer-question\")\n    $pc : PointConcept(name == \"karma points\")\nthen\n\t$pc.setScore($pc.getScore() + answer_question_action_score);\n\tupdate($pc);\nend\n\nrule \"like action\"\nwhen\n\t$action: Action(id == \"like\")\n    $pc : PointConcept(name == \"karma points\")\nthen\n\t$pc.setScore($pc.getScore() + like_action_score);\n\tupdate($pc);\nend\n\nrule \"update description action\"\nwhen\n\t$action: Action(id == \"update-description\")\n    $pc : PointConcept(name == \"karma points\")\nthen\n\t$pc.setScore($pc.getScore() + update_description_action_score);\n\tupdate($pc);\nend", "gameId" : "5a5c9e5d3d30274522896607", "name" : "points" }
{ "_id" : { "$oid" : "5a5c9eab3d30274522896609" }, "_class" : "eu.trentorise.game.model.core.DBRule", "content" : "package  eu.trentorise.game.model\n\nrule \"bronze medal\"\n\tsalience -1000\nwhen \n    PointConcept(name == 'karma points', score >= 100)\n    $bc : BadgeCollectionConcept($badge : 'bronze_medal',name == 'medals', badgeEarned not contains $badge)\nthen\n    $bc.getBadgeEarned().add($badge);\n    update( $bc );\nend\n\n\nrule \"silver medal\"\n\tsalience -1000\nwhen \n    PointConcept(name == 'karma points', score >= 400)\n    $bc : BadgeCollectionConcept($badge : 'silver_medal',name == 'medals', badgeEarned not contains $badge)\nthen\n    $bc.getBadgeEarned().add($badge);\n    update( $bc );\nend\n\n\nrule \"gold medal\"\n\tsalience -1000\nwhen \n    PointConcept(name == 'karma points', score >= 1000)\n    $bc : BadgeCollectionConcept($badge : 'gold_medal',name == 'medals', badgeEarned not contains $badge)\nthen\n    $bc.getBadgeEarned().add($badge);\n    update( $bc );\nend", "gameId" : "5a5c9e5d3d30274522896607", "name" : "medals" }
{ "_id" : { "$oid" : "5a5ca2033d3027452289660a" }, "_class" : "eu.trentorise.game.model.core.DBRule", "content" : "# insert your constants to use in game rules\n# \n# SAMPLE USAGE \n# \n# constants file\n# var_name = var_value\n# \n#\n# usage in rule\n# global VALUE_TYPE var_name;\n#\n# supported VALUE_TYPE\n# Integer (i.e. var=1)\n# Double  (i.e. var=2.3)\n# String  (i.e. var=park)\n# java.util.ArrayList (i.e var=park,street,bikestation)\n\n\nlogin_action_score=5.0\nregistration_action_score=50.0\nmake_question_action_score=10.0\nanswer_question_action_score=20.0\nlike_action_score=5.0\nupdate_description_action_score=15.0\n\nlogin_count_bonus_1=5\nlogin_count_bonus_2=10\nlogin_bonus_1=25.0\nlogin_bonus_2=60.0", "gameId" : "5a5c9e5d3d30274522896607", "name" : "constants" }
